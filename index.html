<!DOCTYPE html>
<html>
<head>
  <title>Drill Maker</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    #lists-container {
      display: block;
    }
   .list-input {
      margin: 10px;
      display: block;
      resize: both;
      overflow: auto;
    }
   .remove-button {
      margin-left: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Drill Maker</h1>
  <label for="defaultLanguage">Default Language:</label>
<select id="defaultLanguage">
  <option value="en" selected>English</option>
  <option value="ja">Japanese</option>
  <option value="fr">French</option>
  <option value="es">Spanish</option>
  <!-- Add more languages as needed -->
</select>
<br>
  <select id="initial-lists-select">
  </select>
  <button id="load-initial-lists-button">Load Initial Lists</button>
  <div id="lists-container"></div>
  <button id="add-list-button">Add List</button>
  <button id="start-button">Start</button>
  <button id="stop-button" disabled>Stop</button>
  <input id="wait-time-input" type="number" value="2" />
  <label for="wait-time-input">Wait time (seconds)</label>
  <br>
  <br>
  <p>Basic usage is to add a lists of words seperated by commas in each "list" text box. The page will then play a random word from the first list, then the second list and so on, repeating again from the top when it reaches the end, with the specified wait time between each word. </p>
  <p>You can place a colon and then the two letter language code for the language you want the text pronouced in. For example:</p>
  <p>dog, inu:ja, cat</p>
  <p>would attempt to pronouce dog and cat in the default language and inu in Japanese if your browser has it available.</p>
  <label>Your browser's available TTS languages:</label>
  <div id="language-list-container"></div>
  <p>If need to add a language see below</p>
  <a href="https://support.microsoft.com/en-us/windows/install-a-language-for-windows-ccd853d3-9ecd-7da7-9ef0-72b4a055410a">Install a language for Windows</a>

  <p>Upload your own lists. Warning this clears your current input.</p>
  <input type="file" id="file-input" accept=".json">
  <p>Download the current default lists as a template.</p>
  <button id="download-button">Download Default Lists</button>
  <p>After downloading the file, open it in a text editor like notepad. Then follow the format to add, remove or edit the lists. You can then upload that file any time to have your own lists available.</p>

  <script>
    const fileInput = document.getElementById('file-input');
    const downloadButton = document.getElementById('download-button');
    const listsContainer = document.getElementById('lists-container');
    const addListButton = document.getElementById('add-list-button');
    const startButton = document.getElementById('start-button');
    const stopButton = document.getElementById('stop-button');
    const waitTimeInput = document.getElementById('wait-time-input');
    const initialListsSelect = document.getElementById('initial-lists-select');
    const loadInitialListsButton = document.getElementById('load-initial-lists-button');
    const listContainer = document.getElementById('language-list-container');
    const languageList = document.createElement('ul');
    const uniqueLanguages = new Set();

    function loadVoices() {
      const voices = window.speechSynthesis.getVoices();
      voices.forEach((voice) => {
        const language = voice.lang;
        if (!uniqueLanguages.has(language)) {
          uniqueLanguages.add(language);
          const listItem = document.createElement('li');
          listItem.textContent = language;
          languageList.appendChild(listItem);
        }
      });

      listContainer.appendChild(languageList);
    }
    loadVoices();

    window.speechSynthesis.onvoiceschanged = () => {
      loadVoices();
    }

    // Add an event listener to the input field to handle file uploads
    fileInput.addEventListener('change', (e) => {
      const file = e.target.files[0];
      const reader = new FileReader();
      reader.onload = (e) => {
        const uploadedLists = JSON.parse(e.target.result);
        // Update the initialLists object with the new data
        //Object.keys(uploadedLists).forEach((listName) => {initialLists[listName] = uploadedLists[listName];});
        initialLists = uploadedLists;
        listsContainer.innerHTML = '';
        setLists(initialLists);
      };
      reader.readAsText(file);
    });

    // Add an event listener to the download button to handle downloads
    downloadButton.addEventListener('click', () => {
      const listsToDownload = initialLists;
      const json = JSON.stringify(listsToDownload, null, 2);
      const blob = new Blob([json], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'default-lists.json';
      a.click();
    });


    let lists = [];
    let currentListIndex = 0;
    let ttsPlayer;
    let playing = false;

    // Define multiple initial lists
    var initialLists = {
      'default': ['north, south, east, west', 'up, down, left, right', 'hello, world', 'foo, bar'],
      'unarmed': ['North, East, South, West', 'Ichimonji:ja, Jumonji:ja, Hicho:ja, Shizen:ja, Doko:ja, Hira Ichimonji:ja, Kosei:ja, Fudoza:ja, Hoko:ja', 'Jump, Roll, Punch, Omote Shuto:ja, Ura Shuto:ja, Front kick, Back kick, Reverse Punch'],
      'rokushyakubo': ['North, East, South, West', 'yellow, orange, purple', 'black, white, gray'],
      'sword': ['North, East, South, West', 'ectangle, hexagon, octagon', 'heart, star, diamond']
    };

    function setLists(listsDict) {
      initialListsSelect.innerHTML = '';
      Object.keys(listsDict).forEach((key) => {
        const option = document.createElement('option');
        console.log(key);
        option.value = key;
        option.textContent = key;
        initialListsSelect.appendChild(option);
      });
    };
    setLists(initialLists);

    loadInitialListsButton.addEventListener('click', () => {
      const selectedInitialList = initialListsSelect.value;
      listsContainer.innerHTML = '';
      lists = [];
      initialLists[selectedInitialList].forEach((list) => {
        const listInput = document.createElement('textarea');
        listInput.rows = 1;
        listInput.cols = 50;
        listInput.value = list;
        listInput.className = 'list-input';

        const removeButton = document.createElement('button');
        removeButton.textContent = 'Remove';
        removeButton.className = 'emove-button';

        const listContainer = document.createElement('div');
        listContainer.appendChild(listInput);
        listContainer.appendChild(removeButton);
        listsContainer.appendChild(listContainer);

        removeButton.addEventListener('click', () => {
          listsContainer.removeChild(listContainer);
          lists = lists.filter((list, index) => index!== lists.indexOf(list));
          if (Array.from(listsContainer.children).length === 0) {
            startButton.disabled = true;
          } else {
            startButton.disabled = false;
          }
        });

        lists.push(list);
      });
    });

    addListButton.addEventListener('click', () => {
      const newListInput = document.createElement('textarea');
      newListInput.rows = 1;
      newListInput.cols = 50;
      newListInput.placeholder = 'Enter list of strings (comma separated)';
      newListInput.className = 'list-input';

      const removeButton = document.createElement('button');
      removeButton.textContent = 'Remove';
      removeButton.className = 'emove-button';

      const listContainer = document.createElement('div');
      listContainer.appendChild(newListInput);
      listContainer.appendChild(removeButton);
      listsContainer.appendChild(listContainer);

      removeButton.addEventListener('click', () => {
        listsContainer.removeChild(listContainer);
        lists = lists.filter((list, index) => index!== lists.indexOf(list));
        if (Array.from(listsContainer.children).length === 0) {
          startButton.disabled = true;
        } else {
          startButton.disabled = false;
        }
      });

      lists.push('');
      startButton.disabled = false;
    });


    startButton.addEventListener('click', () => {
      lists = Array.from(listsContainer.children).map((listContainer) => {
        const defaultLanguageSelect = document.getElementById('defaultLanguage');
        const listInput = listContainer.children[0];
        const list = listInput.value.split(',').map((str) => str.trim());
        return list.map((item) => {
          const match = item.match(/^(.+):([a-z]{2})$/);
          if (match) {
            return { text: match[1], lang: match[2] };
          } else {
            return { text: item, lang: defaultLanguageSelect.value };
          }
        });
      });
      currentListIndex = 0;
      playing = true;
      startButton.disabled = true;
      stopButton.disabled = false;
      playNextList();
    });

    stopButton.addEventListener('click', () => {
      playing = false;
      startButton.disabled = false;
      stopButton.disabled = true;
      window.speechSynthesis.cancel();
    });

    function playNextList() {
      if (!playing) return;
      if (currentListIndex >= lists.length) {
        currentListIndex = 0;
      }

      const currentList = lists[currentListIndex];
      const randomString = currentList[Math.floor(Math.random() * currentList.length)];

      // Play TTS file of random string
      ttsPlayer = new SpeechSynthesisUtterance(randomString.text);
      ttsPlayer.lang = randomString.lang;
      window.speechSynthesis.speak(ttsPlayer);

      setTimeout(() => {
        currentListIndex++;
        playNextList();
      }, waitTimeInput.valueAsNumber*1000);
    }
  </script>
</body>
</html>